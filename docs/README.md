# ConstructFlow Backend API Documentation

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
Backend –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–∞–ø–∫–∞–º–∏ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π.  
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`/api/v1/auth/login`)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (`/api/v1/auth/register`)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`/api/v1/auth/me`)
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ (`/api/v1/auth/role`)

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ docker-compose
- Go 1.20+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- [go-task](https://taskfile.dev/) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ go-task (https://taskfile.dev/install/)
# –î–ª—è macOS:
brew install go-task

# –î–ª—è Linux:
curl -sL https://taskfile.dev/install.sh | sh

# –î–ª—è Windows:
# –°–∫–∞—á–∞–π—Ç–µ .exe —Ñ–∞–π–ª —Å https://github.com/go-task/task/releases
```

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Docker
```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /backend

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (PostgreSQL + –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
docker-compose --build up -d # –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç go-task
task build 

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—á–∏—Å—Ç–∏—Ç—å –ë–î
docker-compose down # –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç go-task
task composedown
```
–ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞:
```
APP_SECRET = your_app_secret
DB_USER = username
DB_PASSWORD = your_password
CONFIG_PATH = configs/local.yaml
```

## API Endpoints

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`POST /api/v1/auth/login`)
**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "login": "user_login",
  "password": "user_password"
}
```

**–û—Ç–≤–µ—Ç (200 OK):**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**–û—à–∏–±–∫–∏:**
- `400 Bad Request`: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞.
- `401 Unauthorized`: –ù–µ–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.
- `404 Not Found`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.
- `500 Internal Server Error`: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

---

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (`POST /api/v1/auth/register`)
**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "login": "new_user",
  "password": "secure_password",
  "role_id": 809
}
```

**–û—Ç–≤–µ—Ç (201 Created):**
```json
{
  "user_id": 123
}
```

**–û—à–∏–±–∫–∏:**
- `400 Bad Request`: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞.
- `404 Not Found`: –†–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
- `409 Conflict`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
- `500 Internal Server Error`: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`GET /api/v1/auth/me`)
**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```http
Authorization: Bearer <JWT_TOKEN>
```

**–û—Ç–≤–µ—Ç (200 OK):**
```json
{
  "id": 123,
  "login": "user_login",
  "role": "user"
}
```

**–û—à–∏–±–∫–∏:**
- `401 Unauthorized`: –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–µ–Ω.
- `404 Not Found`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.
- `500 Internal Server Error`: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ (`POST /api/v1/auth/role`)
**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "role_name": "new_role",
}
```

**–û—Ç–≤–µ—Ç (201 Created):**
```json
{
  "role_id": 123
}
```

**–û—à–∏–±–∫–∏:**
- `400 Bad Request`: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞.
- `409 Conflict`: –†–æ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
- `500 Internal Server Error`: –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

---

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ (curl)

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```bash
curl -X POST http://localhost:8080/auth/login \
-H "Content-Type: application/json" \
-d '{"login": "admin", "password": "admin123"}'
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```bash
curl -X POST http://localhost:8080/auth/register \
-H "Content-Type: application/json" \
-d '{"login": "new_user", "password": "pass123", "role": "user"}'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl http://localhost:8080/auth/me \
-H "Authorization: Bearer <JWT_TOKEN>"
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏
```bash
curl -X POST http://localhost:8080/auth/role \
-H "Content-Type: application/json" \
-d '{"role_name": "new_role"}'
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—à–∏–±–æ–∫
–í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```json
{
  "error": {
    "code": "INVALID_CREDENTIALS",
    "message": "Invalid login or password"
  }
}
```

**–ö–æ–¥—ã –æ—à–∏–±–æ–∫:**
- `UNAUTHORIZED`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ—à–µ–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.
- `MISSING FIELDS`: –ù–µ —É–∫–∞–∑–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –∑–∞–ø—Ä–æ—Å–∞.
- `INVALID_REQUEST`: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞.
- `INVALID_CREDENTIALS`: –ù–µ–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å.
- `USER_NOT_FOUND`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.
- `ROLE_NOT_FOUND`: –†–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
- `USER_ALREADY_EXISTS`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
- `ROLE_ALREADY_EXISTS`: –†–æ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
- `INTERNAL_ERROR`: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
/backend
‚îú‚îÄ‚îÄ cmd/                # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (HTTP-—Å–µ—Ä–≤–µ—Ä)
‚îú‚îÄ‚îÄ internal/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ app/            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ controller/     # HTTP-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ domain/         # –°—É—â–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/ # –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î –∏ –¥—Ä—É–≥–∏–º–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ usecase/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ data/               # –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –¥–∞–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ pkg/                # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã
–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ **[–î–∞–Ω–µ](https://github.com/snowwyd)** üòè
